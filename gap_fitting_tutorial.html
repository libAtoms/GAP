<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Training a GAP model &mdash; GAP  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="_static/soap.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The SOAP descriptor, Gaussian Approximation Potentials (GAP) and machine-learning of force fields" href="gap_si_surface.html" />
    <link rel="prev" title="Computing descriptors from python" href="quippy-descriptor-tutorial.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> GAP
            <img src="_static/soap.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation of QUIP, quippy and GAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="gap_fit.html">The gap_fit program</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quippy-potential-tutorial.html">Using QUIP potentials with Atomic Simulation Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="quippy-descriptor-tutorial.html">Computing descriptors from python</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Training a GAP model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#steps">steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#here-we-will-fit-twice,-to-see-the-difference-between-a-2b-only-and-a-2b+3b-fit">here we will fit twice, to see the difference between a 2b-only and a 2b+3b fit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generating-data-only-with-ASE,-using-the-EMT-calculator">generating data only with ASE, using the EMT calculator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-e0-for-H-and-O---energies-of-the-isolated-atoms">get e0 for H and O - energies of the isolated atoms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#separate-the-dataset-into-a-training-and-a-validation-set">separate the dataset into a training and a validation set</a></li>
<li class="toctree-l3"><a class="reference internal" href="#train-our-GAP-model-from-the-command-line">train our GAP model from the command line</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notice,-that-the-script-is-running-in-parallel,-using-all-8-cores-of-the-current-machine">notice, that the script is running in parallel, using all 8 cores of the current machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-the-potential-with-QUIP-on-trani.xyz-and-validate.xyz">use the potential with QUIP on trani.xyz and validate.xyz</a></li>
<li class="toctree-l3"><a class="reference internal" href="#make-simple-plots-of-the-energies-and-forces-on-the-EMT-and-GAP-datas">make simple plots of the energies and forces on the EMT and GAP datas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#train-our-GAP_3b-model-from-the-command-line">train our GAP_3b model from the command line</a></li>
<li class="toctree-l3"><a class="reference internal" href="#both-training-and-quip-takes-significantly-more-time-than-the-last-one!!!">both training and quip takes significantly more time than the last one!!!</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">use the potential with QUIP on trani.xyz and validate.xyz</a></li>
<li class="toctree-l3"><a class="reference internal" href="#look-at-the-outputs---clear-improvement">look at the outputs - clear improvement</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gap_si_surface.html">The SOAP descriptor, Gaussian Approximation Potentials (GAP) and machine-learning of force fields</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">SOAP and GAP reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">GAP models and databases</a></li>
</ul>

    <p></p>
    <ul>
        <li><a href="genindex.html">Index</a></li>
        <li><a href="py-modindex.html">Module Index</a></li>
<!--        <li><a href="search.html">Search Page</a></li>-->
<!--        <li><a href="_modules/index.html">Module Source Code</a></li>-->
    </ul>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GAP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
      <li>Training a GAP model</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/gap_fitting_tutorial.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Training-a-GAP-model">
<h1>Training a GAP model<a class="headerlink" href="#Training-a-GAP-model" title="Permalink to this heading"></a></h1>
<section id="steps">
<h2>steps<a class="headerlink" href="#steps" title="Permalink to this heading"></a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1. generate a small dataset of water structures
    - use CP2K if you havea access to it
    - otherwise: use any simple potential implemented in ASE, just for trying this out I have used EMT here
1. generate e0 values
1. separate a training and a validation dataset
1. **train the model**
1. look at the outcome of the model
</pre></div>
</div>
</section>
<section id="here-we-will-fit-twice,-to-see-the-difference-between-a-2b-only-and-a-2b+3b-fit">
<h2>here we will fit twice, to see the difference between a 2b-only and a 2b+3b fit<a class="headerlink" href="#here-we-will-fit-twice,-to-see-the-difference-between-a-2b-only-and-a-2b+3b-fit" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># general imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span> <span class="k">as</span> <span class="n">cp</span>

<span class="c1"># ase imports</span>
<span class="kn">import</span> <span class="nn">ase.io</span>
<span class="kn">from</span> <span class="nn">ase</span> <span class="kn">import</span> <span class="n">Atoms</span><span class="p">,</span> <span class="n">Atom</span>
<span class="kn">from</span> <span class="nn">ase</span> <span class="kn">import</span> <span class="n">units</span>
<span class="kn">from</span> <span class="nn">ase.build</span> <span class="kn">import</span> <span class="n">molecule</span>
<span class="c1"># for MD</span>
<span class="kn">from</span> <span class="nn">ase.md.langevin</span> <span class="kn">import</span> <span class="n">Langevin</span>
<span class="kn">from</span> <span class="nn">ase.io.trajectory</span> <span class="kn">import</span> <span class="n">Trajectory</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># helper functions</span>
<span class="k">def</span> <span class="nf">make_water</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">super_cell</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Geenrates a supercell of water molecules with a desired density.</span>
<span class="sd">        Density in g/cm^3!!!&quot;&quot;&quot;</span>
    <span class="n">h2o</span> <span class="o">=</span> <span class="n">molecule</span><span class="p">(</span><span class="s1">&#39;H2O&#39;</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">((</span><span class="nb">sum</span><span class="p">(</span><span class="n">h2o</span><span class="o">.</span><span class="n">get_masses</span><span class="p">())</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">m</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="mf">1E-6</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">density</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mol</span><span class="p">))</span>
    <span class="n">h2o</span><span class="o">.</span><span class="n">set_cell</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
    <span class="n">h2o</span><span class="o">.</span><span class="n">set_pbc</span><span class="p">((</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
    <span class="c1">#return cp(h2o.repeat(super_cell))</span>
    <span class="k">return</span> <span class="n">h2o</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">super_cell</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">rms_dict</span><span class="p">(</span><span class="n">x_ref</span><span class="p">,</span> <span class="n">x_pred</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Takes two datasets of the same shape and returns a dictionary containing RMS error data&quot;&quot;&quot;</span>

    <span class="n">x_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_ref</span><span class="p">)</span>
    <span class="n">x_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_pred</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x_pred</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x_ref</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;WARNING: not matching shapes in rms&#39;</span><span class="p">)</span>

    <span class="n">error_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_ref</span> <span class="o">-</span> <span class="n">x_pred</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="n">average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">error_2</span><span class="p">))</span>
    <span class="n">std_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">error_2</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;rmse&#39;</span><span class="p">:</span> <span class="n">average</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">std_</span><span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="generating-data-only-with-ASE,-using-the-EMT-calculator">
<h2>generating data only with ASE, using the EMT calculator<a class="headerlink" href="#generating-data-only-with-ASE,-using-the-EMT-calculator" title="Permalink to this heading"></a></h2>
<p>This is only for the demonstration of how to do it, this run is will be done very fast. There is no practical use of the data beyond lerning the use teach_sparse, quip, etc. with it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Running MD with ASE&#39;s EMT</span>

<span class="kn">from</span> <span class="nn">ase.calculators.emt</span> <span class="kn">import</span> <span class="n">EMT</span>
<span class="n">calc</span> <span class="o">=</span> <span class="n">EMT</span><span class="p">()</span>

<span class="n">T</span> <span class="o">=</span> <span class="mi">150</span>  <span class="c1"># Kelvin</span>

<span class="c1"># Set up a grid of water</span>
<span class="n">water</span> <span class="o">=</span> <span class="n">make_water</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">water</span><span class="o">.</span><span class="n">set_calculator</span><span class="p">(</span><span class="n">calc</span><span class="p">)</span>

<span class="c1"># We want to run MD using the Langevin algorithm</span>
<span class="c1"># with a time step of 1 fs, the temperature T and the friction</span>
<span class="c1"># coefficient to 0.002 atomic units.</span>
<span class="n">dyn</span> <span class="o">=</span> <span class="n">Langevin</span><span class="p">(</span><span class="n">water</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">T</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">kB</span><span class="p">,</span> <span class="mf">0.0002</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">printenergy</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">water</span><span class="p">):</span>  <span class="c1"># store a reference to atoms in the definition.</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to print the potential, kinetic and total energy.&quot;&quot;&quot;</span>
    <span class="n">epot</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">ekin</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_kinetic_energy</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy per atom: Epot = </span><span class="si">%.3f</span><span class="s1">eV  Ekin = </span><span class="si">%.3f</span><span class="s1">eV (T=</span><span class="si">%3.0f</span><span class="s1">K)  &#39;</span>
          <span class="s1">&#39;Etot = </span><span class="si">%.3f</span><span class="s1">eV&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">epot</span><span class="p">,</span> <span class="n">ekin</span><span class="p">,</span> <span class="n">ekin</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">kB</span><span class="p">),</span> <span class="n">epot</span> <span class="o">+</span> <span class="n">ekin</span><span class="p">))</span>

<span class="n">dyn</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">printenergy</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># We also want to save the positions of all atoms after every 5th time step.</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">Trajectory</span><span class="p">(</span><span class="s1">&#39;dyn_emt.traj&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">water</span><span class="p">)</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Now run the dynamics</span>
<span class="n">printenergy</span><span class="p">(</span><span class="n">water</span><span class="p">)</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span>   <span class="c1"># CHANGE THIS IF YOU WANT LONGER/SHORTER RUN</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Energy per atom: Epot = 0.885eV  Ekin = 0.000eV (T=  0K)  Etot = 0.885eV
Energy per atom: Epot = 0.885eV  Ekin = 0.000eV (T=  0K)  Etot = 0.885eV
Energy per atom: Epot = 0.820eV  Ekin = 0.053eV (T=413K)  Etot = 0.874eV
Energy per atom: Epot = 0.660eV  Ekin = 0.208eV (T=1610K)  Etot = 0.868eV
Energy per atom: Epot = 0.632eV  Ekin = 0.224eV (T=1733K)  Etot = 0.856eV
Energy per atom: Epot = 0.869eV  Ekin = 0.005eV (T= 39K)  Etot = 0.874eV
Energy per atom: Epot = 0.781eV  Ekin = 0.088eV (T=683K)  Etot = 0.869eV
Energy per atom: Epot = 0.756eV  Ekin = 0.117eV (T=904K)  Etot = 0.873eV
Energy per atom: Epot = 0.706eV  Ekin = 0.165eV (T=1274K)  Etot = 0.870eV
Energy per atom: Epot = 0.703eV  Ekin = 0.159eV (T=1227K)  Etot = 0.861eV
Energy per atom: Epot = 0.869eV  Ekin = 0.005eV (T= 40K)  Etot = 0.874eV
Energy per atom: Epot = 0.693eV  Ekin = 0.171eV (T=1323K)  Etot = 0.864eV
Energy per atom: Epot = 0.670eV  Ekin = 0.198eV (T=1529K)  Etot = 0.868eV
Energy per atom: Epot = 0.821eV  Ekin = 0.052eV (T=402K)  Etot = 0.873eV
Energy per atom: Epot = 0.775eV  Ekin = 0.093eV (T=721K)  Etot = 0.869eV
Energy per atom: Epot = 0.804eV  Ekin = 0.068eV (T=524K)  Etot = 0.872eV
Energy per atom: Epot = 0.745eV  Ekin = 0.126eV (T=975K)  Etot = 0.871eV
Energy per atom: Epot = 0.740eV  Ekin = 0.129eV (T=996K)  Etot = 0.869eV
Energy per atom: Epot = 0.779eV  Ekin = 0.093eV (T=721K)  Etot = 0.872eV
Energy per atom: Epot = 0.780eV  Ekin = 0.094eV (T=728K)  Etot = 0.874eV
Energy per atom: Epot = 0.746eV  Ekin = 0.125eV (T=967K)  Etot = 0.871eV
Energy per atom: Epot = 0.743eV  Ekin = 0.127eV (T=980K)  Etot = 0.870eV
Energy per atom: Epot = 0.720eV  Ekin = 0.149eV (T=1153K)  Etot = 0.869eV
Energy per atom: Epot = 0.745eV  Ekin = 0.126eV (T=975K)  Etot = 0.871eV
Energy per atom: Epot = 0.759eV  Ekin = 0.113eV (T=875K)  Etot = 0.872eV
Energy per atom: Epot = 0.726eV  Ekin = 0.144eV (T=1114K)  Etot = 0.870eV
Energy per atom: Epot = 0.722eV  Ekin = 0.148eV (T=1142K)  Etot = 0.869eV
Energy per atom: Epot = 0.742eV  Ekin = 0.128eV (T=993K)  Etot = 0.871eV
Energy per atom: Epot = 0.752eV  Ekin = 0.120eV (T=931K)  Etot = 0.872eV
Energy per atom: Epot = 0.725eV  Ekin = 0.146eV (T=1129K)  Etot = 0.871eV
Energy per atom: Epot = 0.718eV  Ekin = 0.153eV (T=1184K)  Etot = 0.871eV
Energy per atom: Epot = 0.686eV  Ekin = 0.184eV (T=1423K)  Etot = 0.870eV
Energy per atom: Epot = 0.662eV  Ekin = 0.207eV (T=1605K)  Etot = 0.869eV
Energy per atom: Epot = 0.636eV  Ekin = 0.233eV (T=1801K)  Etot = 0.869eV
Energy per atom: Epot = 0.619eV  Ekin = 0.251eV (T=1941K)  Etot = 0.869eV
Energy per atom: Epot = 0.583eV  Ekin = 0.286eV (T=2215K)  Etot = 0.869eV
Energy per atom: Epot = 0.606eV  Ekin = 0.265eV (T=2048K)  Etot = 0.870eV
Energy per atom: Epot = 0.557eV  Ekin = 0.312eV (T=2415K)  Etot = 0.869eV
Energy per atom: Epot = 0.557eV  Ekin = 0.311eV (T=2405K)  Etot = 0.868eV
Energy per atom: Epot = 0.581eV  Ekin = 0.288eV (T=2228K)  Etot = 0.869eV
Energy per atom: Epot = 0.629eV  Ekin = 0.241eV (T=1868K)  Etot = 0.870eV
Energy per atom: Epot = 0.595eV  Ekin = 0.276eV (T=2134K)  Etot = 0.870eV
Energy per atom: Epot = 0.580eV  Ekin = 0.290eV (T=2247K)  Etot = 0.870eV
Energy per atom: Epot = 0.608eV  Ekin = 0.262eV (T=2029K)  Etot = 0.870eV
Energy per atom: Epot = 0.542eV  Ekin = 0.326eV (T=2525K)  Etot = 0.869eV
Energy per atom: Epot = 0.519eV  Ekin = 0.350eV (T=2706K)  Etot = 0.869eV
Energy per atom: Epot = 0.553eV  Ekin = 0.318eV (T=2457K)  Etot = 0.871eV
Energy per atom: Epot = 0.553eV  Ekin = 0.317eV (T=2455K)  Etot = 0.870eV
Energy per atom: Epot = 0.563eV  Ekin = 0.307eV (T=2377K)  Etot = 0.870eV
Energy per atom: Epot = 0.555eV  Ekin = 0.315eV (T=2438K)  Etot = 0.870eV
Energy per atom: Epot = 0.535eV  Ekin = 0.336eV (T=2599K)  Etot = 0.871eV
Energy per atom: Epot = 0.522eV  Ekin = 0.348eV (T=2693K)  Etot = 0.870eV
Energy per atom: Epot = 0.544eV  Ekin = 0.326eV (T=2524K)  Etot = 0.870eV
Energy per atom: Epot = 0.480eV  Ekin = 0.391eV (T=3022K)  Etot = 0.871eV
Energy per atom: Epot = 0.487eV  Ekin = 0.385eV (T=2979K)  Etot = 0.872eV
Energy per atom: Epot = 0.486eV  Ekin = 0.384eV (T=2971K)  Etot = 0.870eV
Energy per atom: Epot = 0.498eV  Ekin = 0.371eV (T=2871K)  Etot = 0.870eV
Energy per atom: Epot = 0.483eV  Ekin = 0.388eV (T=2998K)  Etot = 0.870eV
Energy per atom: Epot = 0.487eV  Ekin = 0.382eV (T=2957K)  Etot = 0.869eV
Energy per atom: Epot = 0.493eV  Ekin = 0.377eV (T=2916K)  Etot = 0.870eV
Energy per atom: Epot = 0.482eV  Ekin = 0.388eV (T=3005K)  Etot = 0.870eV
Energy per atom: Epot = 0.461eV  Ekin = 0.410eV (T=3172K)  Etot = 0.871eV
Energy per atom: Epot = 0.480eV  Ekin = 0.390eV (T=3021K)  Etot = 0.871eV
Energy per atom: Epot = 0.449eV  Ekin = 0.423eV (T=3275K)  Etot = 0.872eV
Energy per atom: Epot = 0.465eV  Ekin = 0.406eV (T=3140K)  Etot = 0.871eV
Energy per atom: Epot = 0.431eV  Ekin = 0.440eV (T=3406K)  Etot = 0.871eV
Energy per atom: Epot = 0.393eV  Ekin = 0.478eV (T=3695K)  Etot = 0.870eV
Energy per atom: Epot = 0.424eV  Ekin = 0.448eV (T=3464K)  Etot = 0.871eV
Energy per atom: Epot = 0.396eV  Ekin = 0.475eV (T=3678K)  Etot = 0.871eV
Energy per atom: Epot = 0.389eV  Ekin = 0.482eV (T=3728K)  Etot = 0.871eV
Energy per atom: Epot = 0.383eV  Ekin = 0.488eV (T=3773K)  Etot = 0.870eV
Energy per atom: Epot = 0.440eV  Ekin = 0.432eV (T=3343K)  Etot = 0.872eV
Energy per atom: Epot = 0.416eV  Ekin = 0.455eV (T=3517K)  Etot = 0.871eV
Energy per atom: Epot = 0.449eV  Ekin = 0.424eV (T=3283K)  Etot = 0.873eV
Energy per atom: Epot = 0.461eV  Ekin = 0.411eV (T=3182K)  Etot = 0.872eV
Energy per atom: Epot = 0.499eV  Ekin = 0.374eV (T=2895K)  Etot = 0.873eV
Energy per atom: Epot = 0.441eV  Ekin = 0.430eV (T=3326K)  Etot = 0.870eV
Energy per atom: Epot = 0.425eV  Ekin = 0.444eV (T=3434K)  Etot = 0.868eV
Energy per atom: Epot = 0.423eV  Ekin = 0.448eV (T=3464K)  Etot = 0.871eV
Energy per atom: Epot = 0.436eV  Ekin = 0.435eV (T=3367K)  Etot = 0.871eV
Energy per atom: Epot = 0.396eV  Ekin = 0.473eV (T=3662K)  Etot = 0.869eV
Energy per atom: Epot = 0.395eV  Ekin = 0.473eV (T=3657K)  Etot = 0.868eV
Energy per atom: Epot = 0.375eV  Ekin = 0.493eV (T=3812K)  Etot = 0.868eV
Energy per atom: Epot = 0.348eV  Ekin = 0.518eV (T=4009K)  Etot = 0.867eV
Energy per atom: Epot = 0.361eV  Ekin = 0.507eV (T=3922K)  Etot = 0.868eV
Energy per atom: Epot = 0.389eV  Ekin = 0.479eV (T=3709K)  Etot = 0.869eV
Energy per atom: Epot = 0.369eV  Ekin = 0.491eV (T=3795K)  Etot = 0.859eV
Energy per atom: Epot = 0.357eV  Ekin = 0.512eV (T=3957K)  Etot = 0.868eV
Energy per atom: Epot = 0.365eV  Ekin = 0.504eV (T=3903K)  Etot = 0.870eV
Energy per atom: Epot = 0.392eV  Ekin = 0.495eV (T=3832K)  Etot = 0.887eV
Energy per atom: Epot = 0.390eV  Ekin = 0.493eV (T=3817K)  Etot = 0.884eV
Energy per atom: Epot = 0.439eV  Ekin = 0.487eV (T=3771K)  Etot = 0.927eV
Energy per atom: Epot = 0.406eV  Ekin = 0.520eV (T=4020K)  Etot = 0.926eV
Energy per atom: Epot = 0.378eV  Ekin = 0.547eV (T=4231K)  Etot = 0.925eV
Energy per atom: Epot = 0.359eV  Ekin = 0.566eV (T=4380K)  Etot = 0.925eV
Energy per atom: Epot = 0.411eV  Ekin = 0.515eV (T=3985K)  Etot = 0.926eV
Energy per atom: Epot = 0.361eV  Ekin = 0.572eV (T=4426K)  Etot = 0.934eV
Energy per atom: Epot = 0.365eV  Ekin = 0.566eV (T=4379K)  Etot = 0.931eV
Energy per atom: Epot = 0.414eV  Ekin = 0.522eV (T=4042K)  Etot = 0.937eV
Energy per atom: Epot = 0.417eV  Ekin = 0.518eV (T=4010K)  Etot = 0.935eV
Energy per atom: Epot = 0.354eV  Ekin = 0.574eV (T=4443K)  Etot = 0.928eV
Energy per atom: Epot = 0.366eV  Ekin = 0.564eV (T=4361K)  Etot = 0.930eV
Energy per atom: Epot = 0.394eV  Ekin = 0.536eV (T=4145K)  Etot = 0.930eV
Energy per atom: Epot = 0.393eV  Ekin = 0.541eV (T=4183K)  Etot = 0.933eV
Energy per atom: Epot = 0.383eV  Ekin = 0.541eV (T=4189K)  Etot = 0.924eV
Energy per atom: Epot = 0.426eV  Ekin = 0.504eV (T=3901K)  Etot = 0.930eV
Energy per atom: Epot = 0.374eV  Ekin = 0.555eV (T=4294K)  Etot = 0.929eV
Energy per atom: Epot = 0.393eV  Ekin = 0.536eV (T=4144K)  Etot = 0.928eV
Energy per atom: Epot = 0.390eV  Ekin = 0.539eV (T=4173K)  Etot = 0.929eV
Energy per atom: Epot = 0.374eV  Ekin = 0.554eV (T=4285K)  Etot = 0.928eV
Energy per atom: Epot = 0.349eV  Ekin = 0.578eV (T=4470K)  Etot = 0.927eV
Energy per atom: Epot = 0.409eV  Ekin = 0.521eV (T=4034K)  Etot = 0.931eV
Energy per atom: Epot = 0.370eV  Ekin = 0.560eV (T=4335K)  Etot = 0.930eV
Energy per atom: Epot = 0.432eV  Ekin = 0.517eV (T=4003K)  Etot = 0.949eV
Energy per atom: Epot = 0.435eV  Ekin = 0.522eV (T=4038K)  Etot = 0.957eV
Energy per atom: Epot = 0.428eV  Ekin = 0.534eV (T=4133K)  Etot = 0.962eV
Energy per atom: Epot = 0.378eV  Ekin = 0.587eV (T=4541K)  Etot = 0.965eV
Energy per atom: Epot = 0.397eV  Ekin = 0.566eV (T=4381K)  Etot = 0.963eV
Energy per atom: Epot = 0.379eV  Ekin = 0.581eV (T=4496K)  Etot = 0.960eV
Energy per atom: Epot = 0.353eV  Ekin = 0.602eV (T=4659K)  Etot = 0.955eV
Energy per atom: Epot = 0.425eV  Ekin = 0.533eV (T=4124K)  Etot = 0.958eV
Energy per atom: Epot = 0.402eV  Ekin = 0.571eV (T=4417K)  Etot = 0.973eV
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># wrap and save traj in .xyz --- the .traj is a non human readable database file, xyz is much better</span>
<span class="n">out_traj</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;dyn_emt.traj&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">out_traj</span><span class="p">:</span>
    <span class="n">at</span><span class="o">.</span><span class="n">wrap</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;momenta&#39;</span> <span class="ow">in</span> <span class="n">at</span><span class="o">.</span><span class="n">arrays</span><span class="p">:</span> <span class="k">del</span> <span class="n">at</span><span class="o">.</span><span class="n">arrays</span><span class="p">[</span><span class="s1">&#39;momenta&#39;</span><span class="p">]</span>
<span class="n">ase</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;dyn_emt.xyz&#39;</span><span class="p">,</span> <span class="n">out_traj</span><span class="p">,</span> <span class="s1">&#39;xyz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="get-e0-for-H-and-O---energies-of-the-isolated-atoms">
<h2>get e0 for H and O - energies of the isolated atoms<a class="headerlink" href="#get-e0-for-H-and-O---energies-of-the-isolated-atoms" title="Permalink to this heading"></a></h2>
<p>This is the energy of the isolated atom, will be in the teach_sparse string in the following format: <code class="docutils literal notranslate"><span class="pre">e0={H:energy:O:energy}</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">isolated_H</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">calculator</span><span class="o">=</span><span class="n">EMT</span><span class="p">(),</span> <span class="n">cell</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">isolated_O</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">calculator</span><span class="o">=</span><span class="n">EMT</span><span class="p">(),</span> <span class="n">cell</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;e0_H:&#39;</span><span class="p">,</span><span class="n">isolated_H</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;e0_O:&#39;</span><span class="p">,</span><span class="n">isolated_O</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">())</span>

<span class="c1"># this made the e0 string be the following: e0={H:3.21:O:4.6}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
e0_H: 3.21
e0_O: 4.6
</pre></div></div>
</div>
</section>
<section id="separate-the-dataset-into-a-training-and-a-validation-set">
<h2>separate the dataset into a training and a validation set<a class="headerlink" href="#separate-the-dataset-into-a-training-and-a-validation-set" title="Permalink to this heading"></a></h2>
<p>As we have 120 frames from the 600fs MD, I will do it 60,60 with taking even and odd frames for the two</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ase</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;train.xyz&#39;</span><span class="p">,</span> <span class="n">out_traj</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">isolated_H</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">isolated_O</span><span class="p">])</span>
<span class="n">ase</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;validate.xyz&#39;</span><span class="p">,</span> <span class="n">out_traj</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">out_traj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arrays</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;numbers&#39;, &#39;positions&#39;])
</pre></div></div>
</div>
</section>
<section id="train-our-GAP-model-from-the-command-line">
<h2>train our GAP model from the command line<a class="headerlink" href="#train-our-GAP-model-from-the-command-line" title="Permalink to this heading"></a></h2>
<p>Will use a fit of 2b only, using the desciptor distance_2b.</p>
<p>Let’s understand how this works. The bash command takes named arguments separated by spaces.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">teach_sparse</span></code> the command which actually does the fit</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">e0={H:3.21:O:4.6}</span></code> the energies of the isolated atoms</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">energy_parameter_name=energy</span> <span class="pre">force_parameter_name=forces</span></code> names of the parameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">do_copy_at_file=F</span> <span class="pre">sparse_separate_file=T</span></code> just needed, don’t want to copy the training data and using separate files for the xml makes it faster</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gp_file=GAP.xml</span></code> filename of the potential parameters, I have always used this name, because I had separate directories for the different trainings potentials</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">at_file=train.xyz</span></code> training file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default_sigma={0.008</span> <span class="pre">0.04</span> <span class="pre">0</span> <span class="pre">0}</span></code> sigma values to be used for energies, forces, stresses, hessians in order; this represents the accuracy of the data and the relative weight of them in the fit (more accurate –&gt; more significant in the fit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gap={...}</span></code> the potential to be fit, separated by ‘:’</p></li>
</ul>
<p><strong>distance_2b</strong> - <code class="docutils literal notranslate"><span class="pre">cutoff=4.0</span></code> radial, practically the highest distance the descriptor takes into account - <code class="docutils literal notranslate"><span class="pre">covariance_type=ard_se</span></code> use gausses in the fit - <code class="docutils literal notranslate"><span class="pre">delta=0.5</span></code> what relative portion of the things shall be determined by this potential - <code class="docutils literal notranslate"><span class="pre">theta_uniform=1.0</span></code> width of the gaussians - <code class="docutils literal notranslate"><span class="pre">sparse_method=uniform</span></code> use uniform bins to choose the sparse points - <code class="docutils literal notranslate"><span class="pre">add_species=T</span></code> take the species into account, so it will generate more GAPs automatically (see the output) - <code class="docutils literal notranslate"><span class="pre">n_sparse=10</span></code>
number of sparse points</p>
</section>
<section id="notice,-that-the-script-is-running-in-parallel,-using-all-8-cores-of-the-current-machine">
<h2>notice, that the script is running in parallel, using all 8 cores of the current machine<a class="headerlink" href="#notice,-that-the-script-is-running-in-parallel,-using-all-8-cores-of-the-current-machine" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>gap_fit<span class="w"> </span><span class="nv">energy_parameter_name</span><span class="o">=</span>energy<span class="w"> </span><span class="nv">force_parameter_name</span><span class="o">=</span>forces<span class="w"> </span><span class="nv">do_copy_at_file</span><span class="o">=</span>F<span class="w"> </span><span class="nv">sparse_separate_file</span><span class="o">=</span>T<span class="w"> </span><span class="nv">gp_file</span><span class="o">=</span>GAP.xml<span class="w"> </span><span class="nv">at_file</span><span class="o">=</span>train.xyz<span class="w"> </span><span class="nv">default_sigma</span><span class="o">={</span><span class="m">0</span>.008<span class="w"> </span><span class="m">0</span>.04<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="o">}</span><span class="w"> </span><span class="nv">gap</span><span class="o">={</span>distance_2b<span class="w"> </span><span class="nv">cutoff</span><span class="o">=</span><span class="m">4</span>.0<span class="w"> </span><span class="nv">covariance_type</span><span class="o">=</span>ard_se<span class="w"> </span><span class="nv">delta</span><span class="o">=</span><span class="m">0</span>.5<span class="w"> </span><span class="nv">theta_uniform</span><span class="o">=</span><span class="m">1</span>.0<span class="w"> </span><span class="nv">sparse_method</span><span class="o">=</span>uniform<span class="w"> </span><span class="nv">add_species</span><span class="o">=</span>T<span class="w"> </span><span class="nv">n_sparse</span><span class="o">=</span><span class="m">10</span><span class="o">}</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
libAtoms::Hello World: 07/10/2019   14:37:12
libAtoms::Hello World: git version  git@github.com:libAtoms/QUIP.git,f538cd9fe-dirty
libAtoms::Hello World: QUIP_ARCH    linux_x86_64_gfortran_openmp
libAtoms::Hello World: compiled on  Oct  1 2019 at 21:54:22
libAtoms::Hello World: OpenMP parallelisation with 4 threads
WARNING: libAtoms::Hello World: environment variable OMP_STACKSIZE not set explicitly. The default value - system and compiler dependent - may be too small for some applications.
libAtoms::Hello World: Random Seed = 52632114
libAtoms::Hello World: global verbosity = 0

Calls to system_timer will do nothing by default


================================ Input parameters ==============================

at_file = train.xyz
gap = &#34;distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform add_species=T n_sparse=10&#34;
e0 = 0.0
local_property0 = 0.0
e0_offset = 0.0
e0_method = isolated
default_sigma = &#34;0.008 0.04 0 0&#34;
sparse_jitter = 1.0e-10
hessian_delta = 1.0e-2
core_param_file = quip_params.xml
core_ip_args =
energy_parameter_name = energy
local_property_parameter_name = local_property
force_parameter_name = forces
virial_parameter_name = virial
hessian_parameter_name = hessian
config_type_parameter_name = config_type
sigma_parameter_name = sigma
config_type_sigma =
sigma_per_atom = T
do_copy_at_file = F
sparse_separate_file = T
sparse_use_actual_gpcov = F
gp_file = GAP.xml
verbosity = NORMAL
rnd_seed = -1
do_ip_timing = F
template_file = template.xyz
sparsify_only_no_fit = F

========================================  ======================================


============== Gaussian Approximation Potentials - Database fitting ============


Initial parsing of command line arguments finished.
Found 1 GAPs.
Descriptors have been parsed
XYZ file read
Old GAP: {distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform add_species=T n_sparse=10}
New GAP: {distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform               n_sparse=10 Z1=8 Z2=8}
New GAP: {distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform               n_sparse=10 Z1=8 Z2=1}
New GAP: {distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform               n_sparse=10 Z1=1 Z2=1}
Multispecies support added where requested

===================== Report on number of descriptors found ====================

---------------------------------------------------------------------
Descriptor: distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform               n_sparse=10 Z1=8 Z2=8
Number of descriptors:                        13192
Number of partial derivatives of descriptors: 79152
---------------------------------------------------------------------
Descriptor: distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform               n_sparse=10 Z1=8 Z2=1
Number of descriptors:                        63476
Number of partial derivatives of descriptors: 380856
---------------------------------------------------------------------
Descriptor: distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform               n_sparse=10 Z1=1 Z2=1
Number of descriptors:                        58986
Number of partial derivatives of descriptors: 353916

========================================  ======================================

E0/atom =   0.32100000000000000E+001  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.45999999999999996E+001  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000

========== Report on number of target properties found in training XYZ: ========

Number of target energies (property name: energy) found: 63
Number of target local_properties (property name: local_property) found: 0
Number of target forces (property name: forces) found: 14829
Number of target virials (property name: virial) found: 0
Number of target Hessian eigenvalues (property name: hessian) found: 0

================================= End of report ================================


===== Report on per-configuration/per-atom sigma (error parameter) settings ====

Number of per-configuration setting of energy_sigma found:     0
Number of per-configuration setting of force_sigma found:      0
Number of per-configuration setting of virial_sigma found:     0
Number of per-configuration setting of hessian_sigma found:    0
Number of per-atom setting of force_atom_sigma found:          0

================================= End of report ================================

Cartesian coordinates transformed to descriptors
Started sparse covariance matrix calculation of coordinate 1

Finished sparse covariance matrix calculation of coordinate 1
TIMER: gpFull_covarianceMatrix_sparse_Coordinate1_sparse  done in .12079600000000001 cpu secs, .33371098999850801E-001 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_Coordinate1         done in .12085800000000002 cpu secs, .33404888999939431E-001 wall clock secs.
Started sparse covariance matrix calculation of coordinate 2

Finished sparse covariance matrix calculation of coordinate 2
TIMER: gpFull_covarianceMatrix_sparse_Coordinate2_sparse  done in .51746400000000004 cpu secs, .13925121800002671 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_Coordinate2         done in .51753099999999996 cpu secs, .13928714700068667 wall clock secs.
Started sparse covariance matrix calculation of coordinate 3

Finished sparse covariance matrix calculation of coordinate 3
TIMER: gpFull_covarianceMatrix_sparse_Coordinate3_sparse  done in .47832100000000000 cpu secs, .12939972799995303 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_Coordinate3         done in .47839199999999993 cpu secs, .12943785000061325 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_LinearAlgebra       done in .58676999999999868E-001 cpu secs, .17518616999950609E-001 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_FunctionValues      done in .20999999999826713E-004 cpu secs, .21754999579570722E-004 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse                     done in 1.1780140000000001 cpu secs, .32216350199996668 wall clock secs.
TIMER: GP sparsify                                        done in 1.2460960000000001 cpu secs, .35651906000020972 wall clock secs.

libAtoms::Finalise: 07/10/2019   14:37:12
libAtoms::Finalise: Bye-Bye!
</pre></div></div>
</div>
</section>
<section id="use-the-potential-with-QUIP-on-trani.xyz-and-validate.xyz">
<h2>use the potential with QUIP on trani.xyz and validate.xyz<a class="headerlink" href="#use-the-potential-with-QUIP-on-trani.xyz-and-validate.xyz" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate train.xyz</span>

<span class="o">!</span><span class="w"> </span>quip<span class="w"> </span><span class="nv">E</span><span class="o">=</span>T<span class="w"> </span><span class="nv">F</span><span class="o">=</span>T<span class="w"> </span><span class="nv">atoms_filename</span><span class="o">=</span>train.xyz<span class="w"> </span><span class="nv">param_filename</span><span class="o">=</span>GAP.xml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>AT<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/AT//&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>quip_train.xyz
<span class="o">!</span><span class="w"> </span>quip<span class="w"> </span><span class="nv">E</span><span class="o">=</span>T<span class="w"> </span><span class="nv">F</span><span class="o">=</span>T<span class="w"> </span><span class="nv">atoms_filename</span><span class="o">=</span>validate.xyz<span class="w"> </span><span class="nv">param_filename</span><span class="o">=</span>GAP.xml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>AT<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/AT//&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>quip_validate.xyz
</pre></div>
</div>
</div>
</section>
<section id="make-simple-plots-of-the-energies-and-forces-on-the-EMT-and-GAP-datas">
<h2>make simple plots of the energies and forces on the EMT and GAP datas<a class="headerlink" href="#make-simple-plots-of-the-energies-and-forces-on-the-EMT-and-GAP-datas" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">energy_plot</span><span class="p">(</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Plot of energy&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Plots the distribution of energy per atom on the output vs the input&quot;&quot;&quot;</span>
    <span class="c1"># read files</span>
    <span class="n">in_atoms</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">in_file</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">out_atoms</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="c1"># list energies</span>
    <span class="n">ener_in</span> <span class="o">=</span> <span class="p">[</span><span class="n">at</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">())</span> <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">in_atoms</span><span class="p">]</span>
    <span class="n">ener_out</span> <span class="o">=</span> <span class="p">[</span><span class="n">at</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">())</span> <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">out_atoms</span><span class="p">]</span>
    <span class="c1"># scatter plot of the data</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ener_in</span><span class="p">,</span> <span class="n">ener_out</span><span class="p">)</span>
    <span class="c1"># get the appropriate limits for the plot</span>
    <span class="n">for_limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ener_in</span> <span class="o">+</span><span class="n">ener_out</span><span class="p">)</span>
    <span class="n">elim</span> <span class="o">=</span> <span class="p">(</span><span class="n">for_limits</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">for_limits</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">elim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">elim</span><span class="p">)</span>
    <span class="c1"># add line of slope 1 for refrence</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">elim</span><span class="p">,</span> <span class="n">elim</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="c1"># set labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;energy by GAP / eV&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;energy by EMT / eV&#39;</span><span class="p">)</span>
    <span class="c1">#set title</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="c1"># add text about RMSE</span>
    <span class="n">_rms</span> <span class="o">=</span> <span class="n">rms_dict</span><span class="p">(</span><span class="n">ener_in</span><span class="p">,</span> <span class="n">ener_out</span><span class="p">)</span>
    <span class="n">rmse_text</span> <span class="o">=</span> <span class="s1">&#39;RMSE:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">_rms</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; +- &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">_rms</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;eV/atom&#39;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">rmse_text</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">force_plot</span><span class="p">(</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_file</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;HO&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Plot of force&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Plots the distribution of firce components per atom on the output vs the input</span>
<span class="sd">        only plots for the given atom type(s)&quot;&quot;&quot;</span>

    <span class="n">in_atoms</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">in_file</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">out_atoms</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>

    <span class="c1"># extract data for only one species</span>
    <span class="n">in_force</span><span class="p">,</span> <span class="n">out_force</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">at_in</span><span class="p">,</span> <span class="n">at_out</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">in_atoms</span><span class="p">,</span> <span class="n">out_atoms</span><span class="p">):</span>
        <span class="c1"># get the symbols</span>
        <span class="n">sym_all</span> <span class="o">=</span> <span class="n">at_in</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">()</span>
        <span class="c1"># add force for each atom</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">sym</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sym_all</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">symbol</span><span class="p">:</span>
                <span class="n">in_force</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at_in</span><span class="o">.</span><span class="n">get_forces</span><span class="p">()[</span><span class="n">j</span><span class="p">])</span>
                <span class="c1">#out_force.append(at_out.get_forces()[j]) \</span>
                <span class="n">out_force</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at_out</span><span class="o">.</span><span class="n">arrays</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="c1"># because QUIP and ASE use different names</span>
    <span class="c1"># convert to np arrays, much easier to work with</span>
    <span class="c1">#in_force = np.array(in_force)</span>
    <span class="c1">#out_force = np.array(out_force)</span>
    <span class="c1"># scatter plot of the data</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">in_force</span><span class="p">,</span> <span class="n">out_force</span><span class="p">)</span>
    <span class="c1"># get the appropriate limits for the plot</span>
    <span class="n">for_limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">in_force</span> <span class="o">+</span> <span class="n">out_force</span><span class="p">)</span>
    <span class="n">flim</span> <span class="o">=</span> <span class="p">(</span><span class="n">for_limits</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">for_limits</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">flim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">flim</span><span class="p">)</span>
    <span class="c1"># add line of</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">flim</span><span class="p">,</span> <span class="n">flim</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="c1"># set labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;force by GAP / (eV/Å)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;force by EMT / (eV/Å)&#39;</span><span class="p">)</span>
    <span class="c1">#set title</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="c1"># add text about RMSE</span>
    <span class="n">_rms</span> <span class="o">=</span> <span class="n">rms_dict</span><span class="p">(</span><span class="n">in_force</span><span class="p">,</span> <span class="n">out_force</span><span class="p">)</span>
    <span class="n">rmse_text</span> <span class="o">=</span> <span class="s1">&#39;RMSE:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">_rms</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; +- &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">_rms</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;eV/Å&#39;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">rmse_text</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;hspace&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">})</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">ax_list</span> <span class="o">=</span> <span class="n">ax_list</span><span class="o">.</span><span class="n">flat</span><span class="p">[:]</span>

<span class="n">energy_plot</span><span class="p">(</span><span class="s1">&#39;train.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;quip_train.xyz&#39;</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Energy on training data&#39;</span><span class="p">)</span>
<span class="n">energy_plot</span><span class="p">(</span><span class="s1">&#39;validate.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;quip_validate.xyz&#39;</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Energy on validation data&#39;</span><span class="p">)</span>
<span class="n">force_plot</span><span class="p">(</span><span class="s1">&#39;train.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;quip_train.xyz&#39;</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;Force on training data - H&#39;</span><span class="p">)</span>
<span class="n">force_plot</span><span class="p">(</span><span class="s1">&#39;train.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;quip_train.xyz&#39;</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;Force on training data - O&#39;</span><span class="p">)</span>
<span class="n">force_plot</span><span class="p">(</span><span class="s1">&#39;validate.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;quip_validate.xyz&#39;</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;Force on validation data - H&#39;</span><span class="p">)</span>
<span class="n">force_plot</span><span class="p">(</span><span class="s1">&#39;validate.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;quip_validate.xyz&#39;</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>  <span class="s1">&#39;Force on validation data - O&#39;</span><span class="p">)</span>

<span class="c1"># if you wanted to have the same limits on the force plots</span>
<span class="c1">#for ax in ax_list[2:]:</span>
<span class="c1">#    flim = (-20, 20)</span>
<span class="c1">#    ax.set_xlim(flim)</span>
<span class="c1">#    ax.set_ylim(flim)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/gap_fitting_tutorial_17_0.png" src="_images/gap_fitting_tutorial_17_0.png" />
</div>
</div>
</section>
<section id="train-our-GAP_3b-model-from-the-command-line">
<h2>train our GAP_3b model from the command line<a class="headerlink" href="#train-our-GAP_3b-model-from-the-command-line" title="Permalink to this heading"></a></h2>
<p>Let’s add three ody terms to the fit, which will hopefully improve it. We will be using the desciprtors distance_2b and angle_3b.</p>
<p><strong>angle_3b</strong> - <code class="docutils literal notranslate"><span class="pre">theta_fac=0.5</span></code> this takes the input data and determines the width from that; useful here, because the dimensions of the descriptor are different - <code class="docutils literal notranslate"><span class="pre">n_sparse=50</span></code> higher dimensional space, more sparse points</p>
</section>
<section id="both-training-and-quip-takes-significantly-more-time-than-the-last-one!!!">
<h2>both training and quip takes significantly more time than the last one!!!<a class="headerlink" href="#both-training-and-quip-takes-significantly-more-time-than-the-last-one!!!" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>gap_fit<span class="w"> </span><span class="nv">energy_parameter_name</span><span class="o">=</span>energy<span class="w"> </span><span class="nv">force_parameter_name</span><span class="o">=</span>forces<span class="w"> </span><span class="nv">do_copy_at_file</span><span class="o">=</span>F<span class="w"> </span><span class="nv">sparse_separate_file</span><span class="o">=</span>T<span class="w"> </span><span class="nv">gp_file</span><span class="o">=</span>GAP_3b.xml<span class="w"> </span><span class="nv">at_file</span><span class="o">=</span>train.xyz<span class="w"> </span><span class="nv">default_sigma</span><span class="o">={</span><span class="m">0</span>.008<span class="w"> </span><span class="m">0</span>.04<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="o">}</span><span class="w"> </span><span class="nv">gap</span><span class="o">={</span>distance_2b<span class="w"> </span><span class="nv">cutoff</span><span class="o">=</span><span class="m">4</span>.0<span class="w"> </span><span class="nv">covariance_type</span><span class="o">=</span>ard_se<span class="w"> </span><span class="nv">delta</span><span class="o">=</span><span class="m">0</span>.5<span class="w"> </span><span class="nv">theta_uniform</span><span class="o">=</span><span class="m">1</span>.0<span class="w"> </span><span class="nv">sparse_method</span><span class="o">=</span>uniform<span class="w"> </span><span class="nv">add_species</span><span class="o">=</span>T<span class="w"> </span><span class="nv">n_sparse</span><span class="o">=</span><span class="m">10</span><span class="w"> </span>:<span class="w"> </span>angle_3b<span class="w"> </span><span class="nv">cutoff</span><span class="o">=</span><span class="m">3</span>.5<span class="w"> </span><span class="nv">covariance_type</span><span class="o">=</span>ard_se<span class="w"> </span><span class="nv">delta</span><span class="o">=</span><span class="m">0</span>.5<span class="w"> </span><span class="nv">theta_fac</span><span class="o">=</span><span class="m">0</span>.5<span class="w"> </span><span class="nv">add_species</span><span class="o">=</span>T<span class="w"> </span><span class="nv">n_sparse</span><span class="o">=</span><span class="m">30</span><span class="w"> </span><span class="nv">sparse_method</span><span class="o">=</span>uniform<span class="o">}</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
libAtoms::Hello World: 07/10/2019   14:37:54
libAtoms::Hello World: git version  git@github.com:libAtoms/QUIP.git,f538cd9fe-dirty
libAtoms::Hello World: QUIP_ARCH    linux_x86_64_gfortran_openmp
libAtoms::Hello World: compiled on  Oct  1 2019 at 21:54:22
libAtoms::Hello World: OpenMP parallelisation with 4 threads
WARNING: libAtoms::Hello World: environment variable OMP_STACKSIZE not set explicitly. The default value - system and compiler dependent - may be too small for some applications.
libAtoms::Hello World: Random Seed = 52674487
libAtoms::Hello World: global verbosity = 0

Calls to system_timer will do nothing by default


================================ Input parameters ==============================

at_file = train.xyz
gap = &#34;distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform add_species=T n_sparse=10 : angle_3b cutoff=3.5 covariance_type=ard_se delta=0.5 theta_fac=0.5 add_species=T n_sparse=30 sparse_method=uniform&#34;
e0 = 0.0
local_property0 = 0.0
e0_offset = 0.0
e0_method = isolated
default_sigma = &#34;0.008 0.04 0 0&#34;
sparse_jitter = 1.0e-10
hessian_delta = 1.0e-2
core_param_file = quip_params.xml
core_ip_args =
energy_parameter_name = energy
local_property_parameter_name = local_property
force_parameter_name = forces
virial_parameter_name = virial
hessian_parameter_name = hessian
config_type_parameter_name = config_type
sigma_parameter_name = sigma
config_type_sigma =
sigma_per_atom = T
do_copy_at_file = F
sparse_separate_file = T
sparse_use_actual_gpcov = F
gp_file = GAP_3b.xml
verbosity = NORMAL
rnd_seed = -1
do_ip_timing = F
template_file = template.xyz
sparsify_only_no_fit = F

========================================  ======================================


============== Gaussian Approximation Potentials - Database fitting ============


Initial parsing of command line arguments finished.
Found 2 GAPs.
Descriptors have been parsed
XYZ file read
Old GAP: {distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform add_species=T n_sparse=10}
New GAP: {distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform               n_sparse=10 Z1=8 Z2=8}
New GAP: {distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform               n_sparse=10 Z1=8 Z2=1}
New GAP: {distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform               n_sparse=10 Z1=1 Z2=1}
Old GAP: { angle_3b cutoff=3.5 covariance_type=ard_se delta=0.5 theta_fac=0.5 add_species=T n_sparse=30 sparse_method=uniform}
New GAP: { angle_3b cutoff=3.5 covariance_type=ard_se delta=0.5 theta_fac=0.5               n_sparse=30 sparse_method=uniform Z=8 Z1=8 Z2=8}
New GAP: { angle_3b cutoff=3.5 covariance_type=ard_se delta=0.5 theta_fac=0.5               n_sparse=30 sparse_method=uniform Z=8 Z1=8 Z2=1}
New GAP: { angle_3b cutoff=3.5 covariance_type=ard_se delta=0.5 theta_fac=0.5               n_sparse=30 sparse_method=uniform Z=8 Z1=1 Z2=1}
New GAP: { angle_3b cutoff=3.5 covariance_type=ard_se delta=0.5 theta_fac=0.5               n_sparse=30 sparse_method=uniform Z=1 Z1=8 Z2=8}
New GAP: { angle_3b cutoff=3.5 covariance_type=ard_se delta=0.5 theta_fac=0.5               n_sparse=30 sparse_method=uniform Z=1 Z1=8 Z2=1}
New GAP: { angle_3b cutoff=3.5 covariance_type=ard_se delta=0.5 theta_fac=0.5               n_sparse=30 sparse_method=uniform Z=1 Z1=1 Z2=1}
Multispecies support added where requested

===================== Report on number of descriptors found ====================

---------------------------------------------------------------------
Descriptor: distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform               n_sparse=10 Z1=8 Z2=8
Number of descriptors:                        13192
Number of partial derivatives of descriptors: 79152
---------------------------------------------------------------------
Descriptor: distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform               n_sparse=10 Z1=8 Z2=1
Number of descriptors:                        63476
Number of partial derivatives of descriptors: 380856
---------------------------------------------------------------------
Descriptor: distance_2b cutoff=4.0 covariance_type=ard_se delta=0.5 theta_uniform=1.0 sparse_method=uniform               n_sparse=10 Z1=1 Z2=1
Number of descriptors:                        58986
Number of partial derivatives of descriptors: 353916
---------------------------------------------------------------------
Descriptor:  angle_3b cutoff=3.5 covariance_type=ard_se delta=0.5 theta_fac=0.5               n_sparse=30 sparse_method=uniform Z=8 Z1=8 Z2=8
Number of descriptors:                        49012
Number of partial derivatives of descriptors: 441108
---------------------------------------------------------------------
Descriptor:  angle_3b cutoff=3.5 covariance_type=ard_se delta=0.5 theta_fac=0.5               n_sparse=30 sparse_method=uniform Z=8 Z1=8 Z2=1
Number of descriptors:                        242862
Number of partial derivatives of descriptors: 2185758
---------------------------------------------------------------------
Descriptor:  angle_3b cutoff=3.5 covariance_type=ard_se delta=0.5 theta_fac=0.5               n_sparse=30 sparse_method=uniform Z=8 Z1=1 Z2=1
Number of descriptors:                        261574
Number of partial derivatives of descriptors: 2354166
---------------------------------------------------------------------
Descriptor:  angle_3b cutoff=3.5 covariance_type=ard_se delta=0.5 theta_fac=0.5               n_sparse=30 sparse_method=uniform Z=1 Z1=8 Z2=8
Number of descriptors:                        124922
Number of partial derivatives of descriptors: 1124298
---------------------------------------------------------------------
Descriptor:  angle_3b cutoff=3.5 covariance_type=ard_se delta=0.5 theta_fac=0.5               n_sparse=30 sparse_method=uniform Z=1 Z1=8 Z2=1
Number of descriptors:                        536486
Number of partial derivatives of descriptors: 4828374
---------------------------------------------------------------------
Descriptor:  angle_3b cutoff=3.5 covariance_type=ard_se delta=0.5 theta_fac=0.5               n_sparse=30 sparse_method=uniform Z=1 Z1=1 Z2=1
Number of descriptors:                        495172
Number of partial derivatives of descriptors: 4456548

========================================  ======================================

E0/atom =   0.32100000000000000E+001  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.45999999999999996E+001  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000  0.00000000000000000E+000

========== Report on number of target properties found in training XYZ: ========

Number of target energies (property name: energy) found: 63
Number of target local_properties (property name: local_property) found: 0
Number of target forces (property name: forces) found: 14829
Number of target virials (property name: virial) found: 0
Number of target Hessian eigenvalues (property name: hessian) found: 0

================================= End of report ================================


===== Report on per-configuration/per-atom sigma (error parameter) settings ====

Number of per-configuration setting of energy_sigma found:     0
Number of per-configuration setting of force_sigma found:      0
Number of per-configuration setting of virial_sigma found:     0
Number of per-configuration setting of hessian_sigma found:    0
Number of per-atom setting of force_atom_sigma found:          0

================================= End of report ================================

Cartesian coordinates transformed to descriptors
Started sparse covariance matrix calculation of coordinate 1

Finished sparse covariance matrix calculation of coordinate 1
TIMER: gpFull_covarianceMatrix_sparse_Coordinate1_sparse  done in .28807099999999952 cpu secs, .10717047499929322 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_Coordinate1         done in .31319400000000019 cpu secs, .11472131200025615 wall clock secs.
Started sparse covariance matrix calculation of coordinate 2

Finished sparse covariance matrix calculation of coordinate 2
TIMER: gpFull_covarianceMatrix_sparse_Coordinate2_sparse  done in .59233300000000000 cpu secs, .16927113200017629 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_Coordinate2         done in .59236500000000003 cpu secs, .16930502099967271 wall clock secs.
Started sparse covariance matrix calculation of coordinate 3

Finished sparse covariance matrix calculation of coordinate 3
TIMER: gpFull_covarianceMatrix_sparse_Coordinate3_sparse  done in .53734700000000046 cpu secs, .15147510299993883 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_Coordinate3         done in .53737699999999933 cpu secs, .15150780800013308 wall clock secs.
Started sparse covariance matrix calculation of coordinate 4

Finished sparse covariance matrix calculation of coordinate 4
TIMER: gpFull_covarianceMatrix_sparse_Coordinate4_sparse  done in 1.6066120000000002 cpu secs, .42011101099978987 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_Coordinate4         done in 1.6066430000000000 cpu secs, .42014362800000526 wall clock secs.
Started sparse covariance matrix calculation of coordinate 5

Finished sparse covariance matrix calculation of coordinate 5
TIMER: gpFull_covarianceMatrix_sparse_Coordinate5_sparse  done in 7.3996139999999997 cpu secs, 2.0708142040002713 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_Coordinate5         done in 7.3996479999999991 cpu secs, 2.0708500330001698 wall clock secs.
Started sparse covariance matrix calculation of coordinate 6

Finished sparse covariance matrix calculation of coordinate 6
TIMER: gpFull_covarianceMatrix_sparse_Coordinate6_sparse  done in 7.7948529999999998 cpu secs, 2.1017793959999835 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_Coordinate6         done in 7.7948830000000005 cpu secs, 2.1018120230000932 wall clock secs.
Started sparse covariance matrix calculation of coordinate 7

Finished sparse covariance matrix calculation of coordinate 7
TIMER: gpFull_covarianceMatrix_sparse_Coordinate7_sparse  done in 3.7665400000000027 cpu secs, .98470028799965803 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_Coordinate7         done in 3.7665709999999990 cpu secs, .98473350699987350 wall clock secs.
Started sparse covariance matrix calculation of coordinate 8

Finished sparse covariance matrix calculation of coordinate 8
TIMER: gpFull_covarianceMatrix_sparse_Coordinate8_sparse  done in 15.648033999999996 cpu secs, 3.9801498979995813 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_Coordinate8         done in 15.648065000000003 cpu secs, 3.9801835840007698 wall clock secs.
Started sparse covariance matrix calculation of coordinate 9

Finished sparse covariance matrix calculation of coordinate 9
TIMER: gpFull_covarianceMatrix_sparse_Coordinate9_sparse  done in 14.597608999999999 cpu secs, 4.0186748889991577 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_Coordinate9         done in 14.597645000000000 cpu secs, 4.0187123029991199 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_LinearAlgebra       done in .58762099999999862 cpu secs, .55210713699943881 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse_FunctionValues      done in .19999999999242846E-004 cpu secs, .19695999981195200E-004 wall clock secs.
TIMER: gpFull_covarianceMatrix_sparse                     done in 52.861531999999997 cpu secs, 14.585489690999566 wall clock secs.
TIMER: GP sparsify                                        done in 53.793665000000004 cpu secs, 15.628059424999265 wall clock secs.

libAtoms::Finalise: 07/10/2019   14:38:19
libAtoms::Finalise: Bye-Bye!
</pre></div></div>
</div>
</section>
<section id="id1">
<h2>use the potential with QUIP on trani.xyz and validate.xyz<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate train.xyz</span>

<span class="o">!</span><span class="w"> </span>quip<span class="w"> </span><span class="nv">E</span><span class="o">=</span>T<span class="w"> </span><span class="nv">F</span><span class="o">=</span>T<span class="w"> </span><span class="nv">atoms_filename</span><span class="o">=</span>train.xyz<span class="w"> </span><span class="nv">param_filename</span><span class="o">=</span>GAP_3b.xml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>AT<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/AT//&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>quip_3b_train.xyz
<span class="o">!</span><span class="w"> </span>quip<span class="w"> </span><span class="nv">E</span><span class="o">=</span>T<span class="w"> </span><span class="nv">F</span><span class="o">=</span>T<span class="w"> </span><span class="nv">atoms_filename</span><span class="o">=</span>validate.xyz<span class="w"> </span><span class="nv">param_filename</span><span class="o">=</span>GAP_3b.xml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>AT<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/AT//&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>quip_3b_validate.xyz
</pre></div>
</div>
</div>
</section>
<section id="look-at-the-outputs---clear-improvement">
<h2>look at the outputs - clear improvement<a class="headerlink" href="#look-at-the-outputs---clear-improvement" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;hspace&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">})</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">ax_list</span> <span class="o">=</span> <span class="n">ax_list</span><span class="o">.</span><span class="n">flat</span><span class="p">[:]</span>

<span class="n">energy_plot</span><span class="p">(</span><span class="s1">&#39;train.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;quip_3b_train.xyz&#39;</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Energy on training data&#39;</span><span class="p">)</span>
<span class="n">energy_plot</span><span class="p">(</span><span class="s1">&#39;validate.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;quip_3b_validate.xyz&#39;</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Energy on validation data&#39;</span><span class="p">)</span>
<span class="n">force_plot</span><span class="p">(</span><span class="s1">&#39;train.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;quip_3b_train.xyz&#39;</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;Force on training data - H&#39;</span><span class="p">)</span>
<span class="n">force_plot</span><span class="p">(</span><span class="s1">&#39;train.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;quip_3b_train.xyz&#39;</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;Force on training data - O&#39;</span><span class="p">)</span>
<span class="n">force_plot</span><span class="p">(</span><span class="s1">&#39;validate.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;quip_3b_validate.xyz&#39;</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;Force on validation data - H&#39;</span><span class="p">)</span>
<span class="n">force_plot</span><span class="p">(</span><span class="s1">&#39;validate.xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;quip_3b_validate.xyz&#39;</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>  <span class="s1">&#39;Force on validation data - O&#39;</span><span class="p">)</span>

<span class="c1"># if you wanted to have the same limits on the force plots</span>
<span class="c1">#for ax in ax_list[2:]:</span>
<span class="c1">#    flim = (-20, 20)</span>
<span class="c1">#    ax.set_xlim(flim)</span>
<span class="c1">#    ax.set_ylim(flim)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/gap_fitting_tutorial_23_0.png" src="_images/gap_fitting_tutorial_23_0.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quippy-descriptor-tutorial.html" class="btn btn-neutral float-left" title="Computing descriptors from python" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="gap_si_surface.html" class="btn btn-neutral float-right" title="The SOAP descriptor, Gaussian Approximation Potentials (GAP) and machine-learning of force fields" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Albert Bartok-Partay, Noam Bernstein, Gabor Csanyi and James Kermode.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>